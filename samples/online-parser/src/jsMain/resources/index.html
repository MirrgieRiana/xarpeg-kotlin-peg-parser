<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Parser Sample</title>
    <meta property="og:title" content="Online Parser Sample | Xarpeg">
    <meta property="og:description" content="Interactive browser-based parser demo built with Xarpeg.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mirrgieriana.github.io/xarpeg-kotlin-peg-parser/online-parser/">
    <meta property="og:image" content="https://mirrgieriana.github.io/xarpeg-kotlin-peg-parser/online-parser/assets/social-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Online Parser Sample | Xarpeg">
    <meta name="twitter:description" content="Interactive browser-based parser demo built with Xarpeg.">
    <meta name="twitter:image" content="https://mirrgieriana.github.io/xarpeg-kotlin-peg-parser/online-parser/assets/social-image.png">
    <link rel="icon" type="image/svg+xml" href="https://raw.githubusercontent.com/MirrgieRiana/xarpeg-kotlin-peg-parser/main/assets/xarpeg-icon.svg">
    <style>
        :root {
            color-scheme: light;
            --surface: #ffffff;
            --ink: #1f2933;
            --muted: #52606d;
            --accent: #2563eb;
            --accent-strong: #1d4ed8;
            --accent-strong-hover: #143ec7;
            --accent-focus: #cbdafe;
            --border: #e5e7eb;
            --textarea-bg: #fbfdff;
            --button-text: #ffffff;
            --shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
            --code-bg: #f8fafc;
            --code-text: #1f2933;
            --code-border: #e5e7eb;
            --code-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        * { box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
            background: radial-gradient(circle at 20% 20%, #f3f6ff, #f8fafc 45%, #eef2ff 100%);
            color: var(--ink);
            margin: 0;
            padding: 2.5rem 1.25rem 3rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1.5rem;
            align-items: start;
        }
        .hero-header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.25rem;
        }
        .hero-brand {
            display: inline-flex;
            align-items: center;
            gap: 0.9rem;
            flex-wrap: wrap;
        }
        .hero-logo {
            width: 78px;
            height: auto;
            filter: drop-shadow(0 8px 16px rgba(37, 99, 235, 0.25));
        }
        .hero-text {
            display: grid;
            gap: 0.2rem;
        }
        .eyebrow {
            margin: 0;
            font-size: 0.85rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-weight: 800;
            color: var(--accent-strong);
        }
        main {
            flex: 1;
            min-width: 0;
            background: var(--surface);
            padding: 2rem 1.75rem;
            border-radius: 18px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .sidebar {
            width: 380px;
            background: var(--surface);
            padding: 2rem 1.75rem;
            border-radius: 18px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: sticky;
            top: 1.25rem;
            max-height: calc(100vh - 2.5rem);
            overflow-y: auto;
            align-self: start;
        }
        h1 {
            margin: 0 0 1rem;
            font-size: clamp(1.6rem, 3vw, 2rem);
            letter-spacing: 0.02em;
        }
        .hero-text h1 {
            margin: 0;
        }
        p.lead { margin: 0 0 1.5rem; color: var(--muted); }
        label { font-weight: 700; color: var(--ink); }
        textarea {
            width: 100%;
            min-height: 0;
            height: auto;
            padding: 0.85rem 1rem;
            margin-top: 0.4rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--textarea-bg);
            color: var(--ink);
            font-size: 1rem;
            line-height: 1.4;
            resize: vertical;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.03);
        }
        textarea:focus {
            outline: 2px solid var(--accent-focus);
            border-color: var(--accent-focus);
        }
        .section {
            display: grid;
            gap: 0.4rem;
            margin-bottom: 1.5rem;
        }
        .muted-text { margin: 0; color: var(--muted); }
        .muted-list { margin: 0.2rem 0 0; padding-left: 1.1rem; color: var(--muted); }
        .muted-list li { margin: 0.2rem 0; }
        .link-row { display: flex; flex-wrap: wrap; gap: 0.6rem; justify-content: flex-end; }
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: space-between;
        }
        button {
            appearance: none;
            border: 1px solid var(--accent-strong);
            background: linear-gradient(135deg, var(--accent), var(--accent-strong));
            color: var(--button-text);
            padding: 0.55rem 1.2rem;
            border-radius: 12px;
            font-weight: 700;
            letter-spacing: 0.01em;
            cursor: pointer;
            box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);
            transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
        }
        button:hover { filter: brightness(1.03); box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); }
        button:active { transform: translateY(1px); }
        .source {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            color: var(--accent-strong);
            font-weight: 700;
            text-decoration: none;
            border-bottom: 1px solid rgba(37, 99, 235, 0.25);
            padding-bottom: 0.08rem;
        }
        .source:hover { color: var(--accent-strong-hover); }
        .hero-link {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.55rem 1rem;
            border-radius: 999px;
            border: 1px solid var(--accent-strong);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(37, 99, 235, 0.22));
            color: var(--accent-strong);
            font-weight: 800;
            text-decoration: none;
            box-shadow: 0 10px 24px rgba(37, 99, 235, 0.15);
            letter-spacing: 0.01em;
        }
        .hero-link:hover { color: var(--accent-strong-hover); filter: brightness(1.03); }
        .hero-link:focus-visible { outline: 2px solid var(--accent-focus); outline-offset: 2px; }
        .code-block {
            margin: 0.4rem 0 0;
            padding: 1rem;
            border-radius: 12px;
            background: var(--code-bg);
            color: var(--code-text);
            border: 1px solid var(--code-border);
            box-shadow: var(--code-shadow);
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre;
            overflow-x: auto;
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .secondary-button {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--ink);
            padding: 0.55rem 1rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 120ms ease;
        }
        .secondary-button:hover {
            background: var(--textarea-bg);
            border-color: var(--accent);
        }
        .secondary-button:active {
            transform: translateY(1px);
        }
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.75rem;
            margin-top: 0.75rem;
        }
        .example-card {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            background: var(--textarea-bg);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 150ms ease;
        }
        .example-card:hover {
            border-color: var(--accent);
            background: var(--surface);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }
        .example-card:active {
            transform: translateY(0);
        }
        .example-title {
            font-weight: 700;
            color: var(--ink);
            margin: 0 0 0.25rem 0;
            font-size: 0.9rem;
        }
        .example-code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.85rem;
            color: var(--muted);
            margin: 0;
            white-space: pre-wrap;
        }
        .output-container {
            position: relative;
        }
        .output-error {
            background: #fff5f5;
            border-color: #feb2b2;
            color: #c53030;
        }
        .output-success {
            background: var(--textarea-bg);
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--muted);
            border-radius: 6px;
            cursor: pointer;
            transition: all 120ms ease;
            opacity: 0;
            pointer-events: none;
        }
        .output-container:hover .copy-button {
            opacity: 1;
            pointer-events: auto;
        }
        .copy-button:hover {
            background: var(--accent);
            color: var(--button-text);
            border-color: var(--accent);
        }
        .copy-button.copied {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
        }
        .keyboard-hint {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }
        kbd {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.1rem 0.4rem;
            font-family: inherit;
            font-size: 0.85em;
        }
        footer {
            width: 100%;
            max-width: 1400px;
            margin: 2rem 0 0;
            text-align: center;
            padding: 2rem 1rem 1rem;
            color: #6a737d;
            font-size: 0.85rem;
        }
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                width: 100%;
                max-height: none;
                position: static;
            }
        }
        @media (max-width: 640px) {
            main, .sidebar {
                padding: 1.5rem 1rem;
            }
            .hero-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .button-group {
                width: 100%;
            }
            button, .secondary-button {
                flex: 1;
                min-width: 0;
            }
        }
    </style>
</head>
    <body>
        <div class="container">
            <main>
            <div class="hero-header">
                <div class="hero-brand">
                    <img class="hero-logo" src="https://raw.githubusercontent.com/MirrgieRiana/xarpeg-kotlin-peg-parser/main/assets/xarpeg-icon.svg" alt="Xarpeg Kotlin PEG Parser icon">
                    <div class="hero-text">
                        <p class="eyebrow">Xarpeg Kotlin PEG Parser</p>
                        <h1>Online Parser Sample</h1>
                    </div>
                </div>
                <a class="hero-link" href="https://github.com/MirrgieRiana/xarpeg-kotlin-peg-parser">View on GitHub</a>
            </div>
            <p class="lead">Enter mathematical expressions in the input field below and click "Evaluate" to see the results. This interactive demo lets you test arithmetic operations, variables, lambda functions, and more. Try the examples on the right to get started, or write your own expressions!</p>

            <div class="section">
                <label for="input">Input</label>
                <textarea id="input" rows="4"></textarea>
                <p class="keyboard-hint">Tip: Press <kbd>Ctrl</kbd>+<kbd>Enter</kbd> (or <kbd>Cmd</kbd>+<kbd>Enter</kbd> on Mac) to evaluate</p>
            </div>

            <div class="section">
                <div class="section-header">
                    <label for="output">Output</label>
                    <div class="button-group">
                        <button id="parse">Evaluate</button>
                        <button id="clear" class="secondary-button">Clear</button>
                    </div>
                </div>
                <div class="output-container">
                    <textarea id="output" rows="5" readonly class="output-success"></textarea>
                    <button id="copy" class="copy-button">Copy</button>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <label>About this sample</label>
                    <div class="link-row">
                        <a class="source" href="https://mirrgieriana.github.io/xarpeg-kotlin-peg-parser/docs/en/">Documentation</a>
                    </div>
                </div>
                <p class="muted-text">The parser evaluates expressions with arithmetic operations, comparison operators, ternary conditionals, variables, lambda expressions, and function calls. Stack traces are shown for runtime errors.</p>
                <ul class="muted-list">
                    <li>Enter expressions using <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, and parentheses.</li>
                    <li>Compare values: <code>5 > 3</code>, <code>10 == 10</code>, <code>x != y</code>, <code>a &lt;= b</code></li>
                    <li>Use ternary operator: <code>condition ? valueIfTrue : valueIfFalse</code></li>
                    <li>Assign variables: <code>x = 10</code></li>
                    <li>Define lambdas: <code>add = (a, b) -&gt; a + b</code></li>
                    <li>Call functions: <code>add(5, 3)</code></li>
                    <li>Identifiers can use letters, digits, and underscore (but cannot start with a digit).</li>
                    <li>Comparison operators return boolean values (<code>true</code>/<code>false</code>) with strict type checking.</li>
                    <li>See the evaluated result or read error messages with stack traces.</li>
                </ul>
            </div>

            <div class="section">
                <div class="section-header">
                    <label>Grammar (PEG)</label>
                    <div class="link-row">
                        <a class="source" href="https://github.com/MirrgieRiana/xarpeg-kotlin-peg-parser/blob/main/samples/online-parser/src/jsMain/kotlin/io/github/mirrgieriana/xarpeg/samples/online/parser/OnlineParser.kt">View Source Code</a>
                    </div>
                </div>
                <p class="muted-text">This grammar includes arithmetic operations, comparison operators, ternary conditionals, variables, lambda expressions, and function calls.</p>
                <pre class="code-block"><code>Expression      &lt;- _ Assignment _
Assignment      &lt;- (Identifier _ '=' _ Assignment) / Ternary
Ternary         &lt;- (Equality _ '?' _ Equality _ ':' _ Equality) / Equality
Equality        &lt;- Ordering (_ ('==' / '!=') _ Ordering)*
Ordering        &lt;- Sum (_ ('&lt;=' / '&gt;=' / '&lt;' / '&gt;') _ Sum)*
Sum             &lt;- Product (_ ('+' / '-') _ Product)*
Product         &lt;- Factor (_ ('*' / '/') _ Factor)*
Factor          &lt;- Lambda / FunctionCall / Variable / Number / '(' _ Expression _ ')'
Lambda          &lt;- '(' _ (Identifier _ (',' _ Identifier _)*)? ')' _ '-&gt;' _ Expression
FunctionCall    &lt;- Identifier _ '(' _ (Expression _ (',' _ Expression _)*)? ')'
Variable        &lt;- Identifier
Identifier      &lt;- [a-zA-Z_][a-zA-Z0-9_]*
Number          &lt;- [0-9]+ ('.' [0-9]+)?
_               &lt;- [ \t\r\n]*</code></pre>
            </div>
        </main>

        <aside class="sidebar">
            <div class="section">
                <label>Try Examples</label>
                <p class="muted-text">Click any example below to try it in the parser:</p>
                <div class="examples-grid">
                    <div class="example-card" data-example="2 * (3 + 4)">
                        <p class="example-title">Basic Arithmetic</p>
                        <code class="example-code">2 * (3 + 4)</code>
                    </div>
                    <div class="example-card" data-example="x = 5 + 10">
                        <p class="example-title">Variable Assignment</p>
                        <code class="example-code">x = 5 + 10</code>
                    </div>
                    <div class="example-card" data-example="add = (a, b) -> a + b">
                        <p class="example-title">Lambda Function</p>
                        <code class="example-code">add = (a, b) -> a + b</code>
                    </div>
                    <div class="example-card" data-example="double = (x) -> x * 2&#10;double(7)">
                        <p class="example-title">Single Parameter Lambda</p>
                        <code class="example-code">double = (x) -> x * 2
double(7)</code>
                    </div>
                    <div class="example-card" data-example="result = (10 + 5) * 2 - 8&#10;result">
                        <p class="example-title">Complex Expression</p>
                        <code class="example-code">result = (10 + 5) * 2 - 8
result</code>
                    </div>
                    <div class="example-card" data-example="calc = (x, y) -> (x + y) * 2&#10;calc(3, 5)">
                        <p class="example-title">Multi-param Lambda</p>
                        <code class="example-code">calc = (x, y) -> (x + y) * 2
calc(3, 5)</code>
                    </div>
                    <div class="example-card" data-example="pi = 3.14159&#10;pi * 2">
                        <p class="example-title">Decimal Numbers</p>
                        <code class="example-code">pi = 3.14159
pi * 2</code>
                    </div>
                    <div class="example-card" data-example="my_var_123 = 42&#10;my_var_123 + 8">
                        <p class="example-title">Identifier with Numbers</p>
                        <code class="example-code">my_var_123 = 42
my_var_123 + 8</code>
                    </div>
                    <div class="example-card" data-example="5 > 3">
                        <p class="example-title">Comparison Operator</p>
                        <code class="example-code">5 > 3</code>
                    </div>
                    <div class="example-card" data-example="x = 10&#10;y = 20&#10;x == y">
                        <p class="example-title">Equality Check</p>
                        <code class="example-code">x = 10
y = 20
x == y</code>
                    </div>
                    <div class="example-card" data-example="5 > 3 ? 100 : 200">
                        <p class="example-title">Ternary Operator</p>
                        <code class="example-code">5 > 3 ? 100 : 200</code>
                    </div>
                    <div class="example-card" data-example="x = 15&#10;x >= 10 ? 1 : 0">
                        <p class="example-title">Conditional Expression</p>
                        <code class="example-code">x = 15
x >= 10 ? 1 : 0</code>
                    </div>
                    <div class="example-card" data-example="factorial = (n) -> n <= 1 ? 1 : n * factorial(n - 1)&#10;factorial(5)">
                        <p class="example-title">Recursive Factorial</p>
                        <code class="example-code">factorial = (n) -> n <= 1 ? 1 : n * factorial(n - 1)
factorial(5)</code>
                    </div>
                    <div class="example-card" data-example="func1 = (a, b) -> a / b&#10;func2 = (a, b) -> func1(a + b, a - b)&#10;func2(10, 10)">
                        <p class="example-title">Error Stack Trace</p>
                        <code class="example-code">func1 = (a, b) -> a / b
func2 = (a, b) -> func1(a + b, a - b)
func2(10, 10)</code>
                    </div>
                    <div class="example-card" data-example="2 * (3 + 4">
                        <p class="example-title">Syntax Error: Missing Paren</p>
                        <code class="example-code">2 * (3 + 4</code>
                    </div>
                    <div class="example-card" data-example="5 + * 3">
                        <p class="example-title">Syntax Error: Invalid Operator</p>
                        <code class="example-code">5 + * 3</code>
                    </div>
                    <div class="example-card" data-example="x = ">
                        <p class="example-title">Syntax Error: Incomplete Expression</p>
                        <code class="example-code">x = </code>
                    </div>
                    <div class="example-card" data-example="123abc = 5">
                        <p class="example-title">Syntax Error: Invalid Identifier</p>
                        <code class="example-code">123abc = 5</code>
                    </div>
                    <!--
                    TODO: Uncomment when open class ParseContext is published:
                    These examples demonstrate indent-based language parsing (Python-style).
                    
                    <div class="example-card" data-example="fun hello:&#10;    world" data-parser="indent">
                        <p class="example-title">Indent: Simple Function</p>
                        <code class="example-code">fun hello:
    world</code>
                    </div>
                    <div class="example-card" data-example="fun test:&#10;    a&#10;    b&#10;    c" data-parser="indent">
                        <p class="example-title">Indent: Multiple Statements</p>
                        <code class="example-code">fun test:
    a
    b
    c</code>
                    </div>
                    <div class="example-card" data-example="fun empty:&#10;fun another:&#10;    x" data-parser="indent">
                        <p class="example-title">Indent: Empty Function</p>
                        <code class="example-code">fun empty:
fun another:
    x</code>
                    </div>
                    -->
                </div>
            </div>
        </aside>
    </div>

    <footer>
        ⚠️ This documentation was predominantly generated by AI and may contain inaccuracies. Please verify against the source code.
    </footer>

    <script type="module">
        import { parseExpression } from "./online-parser.mjs";
        // TODO: Uncomment when open class ParseContext is published:
        // import { parseIndentCode } from "./online-parser.mjs";

        const input = document.getElementById("input");
        const output = document.getElementById("output");
        const parseButton = document.getElementById("parse");
        const clearButton = document.getElementById("clear");
        const copyButton = document.getElementById("copy");
        const exampleCards = document.querySelectorAll(".example-card");
        const defaultInput = "x = 10";

        const updateOutput = () => {
            // TODO: Uncomment when open class ParseContext is published:
            // const parserType = input.dataset.parser || 'expression';
            // const result = parserType === 'indent' 
            //     ? parseIndentCode(input.value)
            //     : parseExpression(input.value);
            const result = parseExpression(input.value);
            output.value = result;
            
            // Update output styling based on result type
            if (result.startsWith("Error")) {
                output.classList.remove("output-success");
                output.classList.add("output-error");
            } else {
                output.classList.remove("output-error");
                output.classList.add("output-success");
            }
        };

        const updateUrlQuery = () => {
            const url = new URL(window.location.href);
            url.searchParams.set("q", input.value);
            window.history.replaceState(null, "", url);
        };

        const clearInput = () => {
            input.value = "";
            output.value = "";
            input.focus();
            updateUrlQuery();
        };

        const copyOutput = async () => {
            try {
                await navigator.clipboard.writeText(output.value);
                copyButton.textContent = "Copied!";
                copyButton.classList.add("copied");
                setTimeout(() => {
                    copyButton.textContent = "Copy";
                    copyButton.classList.remove("copied");
                }, 2000);
            } catch (err) {
                console.error("Failed to copy:", err);
            }
        };

        const loadExample = (exampleText) => {
            input.value = exampleText;
            updateUrlQuery();
            updateOutput();
        };

        // Event listeners
        parseButton.addEventListener("click", updateOutput);
        clearButton.addEventListener("click", clearInput);
        copyButton.addEventListener("click", copyOutput);

        input.addEventListener("input", () => {
            updateUrlQuery();
            updateOutput();
        });

        // Keyboard shortcuts
        input.addEventListener("keydown", (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
                e.preventDefault();
                updateOutput();
            }
        });

        // Example card click handlers
        exampleCards.forEach(card => {
            card.addEventListener("click", () => {
                const example = card.getAttribute("data-example");
                // TODO: Uncomment when open class ParseContext is published:
                // const parser = card.getAttribute("data-parser") || 'expression';
                // input.dataset.parser = parser;
                loadExample(example);
            });
        });

        // Set default input value only if input is empty on page load
        if (input.value.trim() === "") {
            const qParam = new URLSearchParams(window.location.search).get("q");
            if (qParam !== null) {
                input.value = qParam;
            } else {
                input.value = defaultInput;
            }
        }
        updateOutput();
    </script>
</body>
</html>
